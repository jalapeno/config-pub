apiVersion: v1
kind: ConfigMap
metadata:
  name: config-pub-config
  namespace: jalapeno
data:
  config.yaml: |
    interval: 0s
    kafka:
      brokers:
        - "broker.jalapeno:9092"
      topic: "gnmi-config"
    gnmi:
      dial_timeout: 10s
      request_timeout: 20s
      encoding: "json_ietf"
      type: "config"
      paths:
        - "/"
    hosts:
      - name: "xrd01"
        address: "172.20.1.101:57400"
        target: "xrd01"
      - name: "xrd02"
        address: "172.20.1.102:57400"
        target: "xrd02"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: config-pub
  namespace: jalapeno
spec:
  replicas: 1
  selector:
    matchLabels:
      app: config-pub
  template:
    metadata:
      labels:
        app: config-pub
    spec:
      containers:
        - name: config-pub
          image: config-pub:latest
          imagePullPolicy: IfNotPresent
          args:
            - "-config"
            - "/etc/config-pub/config.yaml"
          env:
            - name: GNMI_USERNAME
              valueFrom:
                secretKeyRef:
                  name: config-pub-gnmi
                  key: username
            - name: GNMI_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: config-pub-gnmi
                  key: password
          volumeMounts:
            - name: config
              mountPath: /etc/config-pub
              readOnly: true
      volumes:
        - name: config
          configMap:
            name: config-pub-config
---
apiVersion: v1
kind: Secret
metadata:
  name: config-pub-gnmi
  namespace: jalapeno
type: Opaque
stringData:
  username: "cisco"
  password: "cisco123"

